---
phase: 02-core-video-generation
plan: 03
type: execute
wave: 3
depends_on: ["02-02"]
files_modified:
  - tools/nanobanana/nanobanana.py
  - tools/nanobanana/CLAUDE.md
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User can run nanobanana --video 'prompt' to generate video"
    - "User can specify --duration (4, 6, 8) for video length"
    - "User can specify --aspect-ratio (16:9, 9:16) for orientation"
    - "Progress display shows elapsed time during generation"
    - "Video file path is printed on success"
  artifacts:
    - path: "tools/nanobanana/nanobanana.py"
      provides: "--video flag and video-related CLI options"
      contains: "--video"
    - path: "tools/nanobanana/CLAUDE.md"
      provides: "Updated documentation with video usage"
      contains: "nanobanana --video"
  key_links:
    - from: "tools/nanobanana/nanobanana.py"
      to: "tools/nanobanana/video.py"
      via: "import and function call"
      pattern: "from video import generate_video"
---

<objective>
Add video generation CLI interface to nanobanana with duration and aspect ratio options.

Purpose: Enable users to generate videos through the same nanobanana CLI they use for images, with intuitive flags for video-specific options.

Output: Updated nanobanana.py with --video flag and updated CLAUDE.md documentation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-core-video-generation/02-02-SUMMARY.md
@tools/nanobanana/nanobanana.py
@tools/nanobanana/video.py
@tools/nanobanana/CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add video CLI arguments to nanobanana.py</name>
  <files>tools/nanobanana/nanobanana.py</files>
  <action>
Update the argparse configuration in main() to add video-related arguments.

Add these new arguments to the ArgumentParser:

```python
parser.add_argument("--video", action="store_true",
                    help="Generate video instead of image")
parser.add_argument("--duration", type=int, choices=[4, 6, 8], default=8,
                    help="Video duration in seconds (4, 6, or 8; default: 8)")
parser.add_argument("--aspect-ratio", choices=["16:9", "9:16"], default="16:9",
                    help="Video aspect ratio (16:9 landscape, 9:16 portrait; default: 16:9)")
```

Update the description and epilog to include video examples:

```python
description="Generate and edit images, or generate videos using Gemini 3 Pro"

epilog="""
Examples:
  nanobanana --setup                              Extract cookies from browser
  nanobanana "a sunset over mountains"            Generate image
  nanobanana --edit photo.png "make it vintage"   Edit existing image
  nanobanana --video "ocean waves"                Generate video (default 8s, 16:9)
  nanobanana --video --duration 4 "quick clip"    4-second video
  nanobanana --video --aspect-ratio 9:16 "..."    Portrait video for mobile
  nanobanana --json "test prompt"                 JSON output (for agents)
"""
```

Ensure --video and --edit are mutually exclusive by adding validation:
```python
if args.video and args.edit:
    parser.error("Cannot use --video with --edit")
```
  </action>
  <verify>cd /Users/pete/Projects/mr-tools/tools/nanobanana && python3 nanobanana.py --help | grep -q "\-\-video"</verify>
  <done>Video CLI arguments added to argparse</done>
</task>

<task type="auto">
  <name>Task 2: Add video generation handler in main()</name>
  <files>tools/nanobanana/nanobanana.py</files>
  <action>
Add the video generation branch to the main() function.

1. Add import at top of file (with other imports):
```python
from video import generate_video
```

2. In main(), add video handling branch before the image generation:

```python
# Choose between video, edit, and generate modes
if args.video:
    # Video generation mode
    output_dir = Path(args.dir) if args.dir else Path.home() / ".nanobanana" / "videos"
    filename = args.output if args.output else datetime.now().strftime("%Y%m%d_%H%M%S")

    result = asyncio.run(generate_video(
        args.prompt,
        output_dir=output_dir,
        filename=filename,
        duration=args.duration,
        aspect_ratio=args.aspect_ratio,
        timeout=args.timeout,
        debug=args.debug
    ))
elif args.edit:
    # Edit mode (existing code)
    ...
else:
    # Image generation mode (existing code)
    ...
```

3. Output handling already works for both - the result dict has same structure:
   - {"status": "complete", "filepath": "..."} on success
   - {"status": "error", "error": "..."} on failure

The existing output logic (lines 449-462) handles both JSON and plain output modes.

Make sure video output directory uses "videos" subdirectory, not "images".
  </action>
  <verify>cd /Users/pete/Projects/mr-tools/tools/nanobanana && python3 -c "from nanobanana import main; print('Video handler integrated')"</verify>
  <done>Video generation handler added to main() with duration and aspect ratio support</done>
</task>

<task type="auto">
  <name>Task 3: Update CLAUDE.md documentation</name>
  <files>tools/nanobanana/CLAUDE.md</files>
  <action>
Update the tool documentation to include video generation capabilities.

1. Update the Overview section to mention video generation:
```markdown
- **nanobanana**: Image generation, editing, AND video generation via Gemini 3 Pro / Veo
```

2. Add Video Generation to the Quick Start:
```markdown
# Generate videos
nanobanana --video "ocean waves at sunset"
nanobanana --video --duration 4 "quick clip"
nanobanana --video --aspect-ratio 9:16 "vertical video"
nanobanana --video --json "prompt" -o myvideo
```

3. Add a new section for Video Generation:
```markdown
## Video Generation

Generate videos using Gemini Veo:

\`\`\`bash
nanobanana --video "prompt"                       # Generate 8s 16:9 video
nanobanana --video --duration 4 "prompt"          # 4-second video
nanobanana --video --duration 6 "prompt"          # 6-second video
nanobanana --video --aspect-ratio 9:16 "prompt"   # Portrait video
nanobanana --video -o name -d /path "prompt"      # Custom output
nanobanana --video --json "prompt"                # JSON output
\`\`\`

**Options:**
- `--duration`: Video length in seconds (4, 6, or 8; default: 8)
- `--aspect-ratio`: Video orientation (16:9 landscape, 9:16 portrait; default: 16:9)

**Output locations:**
- Default: `~/.nanobanana/videos/<timestamp>.mp4`
- Custom: `-d /path -o name` creates `/path/name.mp4`

**Daily Limit:**
- ~2 videos per day with AI Pro subscription
- "You have 2 video generation requests running" = max concurrent reached

**Generation Time:**
- Typically 30-120 seconds
- Tool displays elapsed time during generation
- Default timeout: 10 minutes (600 seconds)

**JSON output format:**
\`\`\`json
{"status": "complete", "filepath": "/path/to/video.mp4", "elapsed_seconds": 45}
\`\`\`
```

4. Update the Model Information table to include video:
```markdown
| nanobanana --video | Veo 3.1 | Video generation | 4-8s MP4 |
```

5. Update the Confirmed Capabilities table if present.
  </action>
  <verify>grep -q "nanobanana --video" /Users/pete/Projects/mr-tools/tools/nanobanana/CLAUDE.md</verify>
  <done>CLAUDE.md updated with video generation documentation</done>
</task>

</tasks>

<verification>
- `nanobanana --help` shows --video, --duration, --aspect-ratio options
- `nanobanana --video "test"` triggers video generation (may fail if no cookies, but should reach video code path)
- CLAUDE.md includes video generation examples
- --video and --edit are mutually exclusive
</verification>

<success_criteria>
User can run:
```bash
nanobanana --video "ocean waves at sunset"
```
And receive a video file path on success, with elapsed time shown during generation.
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-video-generation/02-03-SUMMARY.md`
</output>
