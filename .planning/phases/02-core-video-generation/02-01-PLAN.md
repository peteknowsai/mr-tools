---
phase: 02-core-video-generation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/02-core-video-generation/02-API-CAPTURE.md
autonomous: false
user_setup: []

must_haves:
  truths:
    - "Video generation request format is fully documented"
    - "Model header for video mode is captured"
    - "Polling mechanism (if any) is identified"
    - "Video URL retrieval pattern is documented"
  artifacts:
    - path: ".planning/phases/02-core-video-generation/02-API-CAPTURE.md"
      provides: "Complete API format documentation for video generation"
      contains: "x-goog-ext"
  key_links:
    - from: "02-API-CAPTURE.md"
      to: "Plan 02 video.py implementation"
      via: "Documented endpoint, headers, body format"
      pattern: "VIDEO_MODEL_HEADER"
---

<objective>
Capture the exact API format for Gemini video generation via Chrome DevTools.

Purpose: The gemini-webapi library is broken - we must reverse-engineer the API format to build a custom HTTP client. This is the critical blocking step for all video functionality.

Output: 02-API-CAPTURE.md with complete documentation of endpoints, headers, request body, and response structure.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-video-generation/02-RESEARCH.md
@.planning/research/video-generation-findings.md
@tools/nanobanana/nanobanana.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Prepare DevTools capture instructions</name>
  <files>.planning/phases/02-core-video-generation/02-API-CAPTURE.md</files>
  <action>
Create the API capture documentation file with a template structure and detailed instructions for the human to follow.

Include sections for:
1. **Capture Instructions** - Step-by-step guide for using Chrome DevTools
2. **Expected Requests** - What to look for (StreamGenerate or different endpoint?)
3. **Template Sections** - Placeholders for:
   - Video trigger endpoint URL
   - Video model header (x-goog-ext-525001261-jspb value)
   - Request body format (idx parameters)
   - Polling endpoint (if different from trigger)
   - Video URL pattern in response
   - Duration/aspect ratio parameters (if visible)

Reference nanobanana.py lines 36-42 for the image generation header format as comparison:
```python
MODEL_HEADER = {"x-goog-ext-525001261-jspb": '[1,null,null,null,"9d8ca3786ebdfbea",null,null,0,[4],null,null,2]'}
```

The video header will likely have a different model ID instead of "9d8ca3786ebdfbea".
  </action>
  <verify>File exists with template structure and clear instructions</verify>
  <done>02-API-CAPTURE.md created with template ready for human capture</done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <action>
User must capture the video generation API format using Chrome DevTools:

1. Open Chrome, navigate to https://gemini.google.com
2. Ensure logged in with AI Pro subscription
3. Open DevTools (F12) > Network tab
4. Enable "Preserve log" checkbox
5. Filter by "Fetch/XHR"
6. Click "Create a video" button in the Gemini interface
7. Enter prompt: "Generate a 4-second video of ocean waves at sunset"
8. Submit and watch Network tab

Capture these details:
- **Trigger request**: URL, full headers (especially x-goog-ext-*), request body
- **Any polling requests**: Repeated requests after trigger
- **Video URL**: Where does the final video URL appear?

Fill in the 02-API-CAPTURE.md template with captured values.
  </action>
  <instructions>
Follow the instructions in 02-API-CAPTURE.md to capture the API format.
Use Chrome DevTools Network tab with "Preserve log" enabled.
Copy exact header values - the model ID in x-goog-ext header is critical.
  </instructions>
  <resume-signal>Type "captured" when 02-API-CAPTURE.md is filled in with the real values</resume-signal>
</task>

<task type="auto">
  <name>Task 3: Validate and finalize capture documentation</name>
  <files>.planning/phases/02-core-video-generation/02-API-CAPTURE.md</files>
  <action>
Review the captured API format for completeness:

1. Verify the video model header is captured (should be different from image header "9d8ca3786ebdfbea")
2. Verify the request body format is documented (what idx parameters for video?)
3. Verify polling mechanism is documented (endpoint, interval, completion indicator)
4. Verify video URL pattern is documented (where in response, auth requirements)

If any sections are incomplete, add notes about what's missing for Phase 2 to investigate.

Add a "Ready for Implementation" section summarizing:
- Confirmed working: [list what's verified]
- Needs investigation: [list any gaps]
- Code constants to add: VIDEO_MODEL_HEADER, VIDEO_BODY_PARAMS, etc.
  </action>
  <verify>cat .planning/phases/02-core-video-generation/02-API-CAPTURE.md | grep -q "Ready for Implementation"</verify>
  <done>API capture documentation is complete with implementation-ready summary</done>
</task>

</tasks>

<verification>
- 02-API-CAPTURE.md exists with captured values (not template placeholders)
- Video model header documented (x-goog-ext value)
- Request body format documented (idx parameters or equivalent)
- Polling mechanism documented (if exists)
- Video URL retrieval documented
</verification>

<success_criteria>
Phase 2 Plan 02 can read 02-API-CAPTURE.md and implement the video generation client without needing additional DevTools investigation.
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-video-generation/02-01-SUMMARY.md`
</output>
